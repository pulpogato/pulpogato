= Pulpogato
:package: io.github.pulpogato
:package-path: io/github/pulpogato
:package-path-encoded: io%2Fgithub%2Fpulpogato
:snapshot-prefix: image:https://img.shields.io/maven-metadata/v?metadataUrl=https%3A%2F%2Fcentral.sonatype.com%2Frepository%2Fmaven-snapshots%2F{package-path-encoded}%2F
:snapshot-middle: %2Fmaven-metadata.xml&style=for-the-badge&label=S[alt=Maven Snapshot,height=30,link="https://central.sonatype.com/repository/maven-snapshots/{package-path}/
:snapshot-suffix: /maven-metadata.xml"]
:central-prefix: image:https://img.shields.io/maven-central/v/{package}/
:central-middle: ?style=for-the-badge&label=R&color=green[alt=Maven Central Version,height=30,link="https://central.sonatype.com/artifact/{package}/
:central-suffix: /overview"]
:deprecated-middle: ?style=for-the-badge&label=R&color=lightgrey[alt=Maven Central Version,height=30,link="https://central.sonatype.com/artifact/{package}/
:nofooter:
:source-highlighter: rouge
:toc: left
:icons: font

Pulpogato is a java client for GitHub.

== Installation

include::../../README.adoc[tags=installation]

== Usage

=== REST Client Example

This shows how to create a REST client and get the authenticated user.
Ideally, you would inject the WebClient and export a Bean for RestClients.
If you're supporting multiple GitHub Apps or sites, you would export a factory bean instead.

[source,java]
----
public class RestExample {
    public static void main(String[] args) {
        // create a WebClient
        WebClient webClient = WebClient.builder()
                .baseUrl("https://api.github.com")
                .defaultHeader(HttpHeaders.AUTHORIZATION, "Bearer ...your token here...")
                .build();

include::../../pulpogato-rest-fpt/src/test/java/io/github/pulpogato/rest/api/UsersApiIntegrationTest.java[tags=getAuthenticatedPublic]
include::../../pulpogato-rest-fpt/src/test/java/io/github/pulpogato/rest/api/UsersApiIntegrationTest.java[tags=getBody]
include::../../pulpogato-rest-fpt/src/test/java/io/github/pulpogato/rest/api/UsersApiIntegrationTest.java[tags=getUser]
include::../../pulpogato-rest-fpt/src/test/java/io/github/pulpogato/rest/api/UsersApiIntegrationTest.java[tags=getLogin]

    }
}
----

=== Webhook Example

This shows how to create a Webhook handler that listens for ping events.
There are many other event types you can listen for.

[source,java,indent=0]
----
include::../../pulpogato-rest-fpt/src/test/java/io/github/pulpogato/rest/webhooks/PingWebhooksIntegrationTest.java[tags=ping-webhook-controller]
----

=== GraphQL Client Example

This shows how to create a GraphQL client and get the authenticated user.
Ideally, you would inject the WebClient and export a Bean for GraphQLClients.
If you're supporting multiple GitHub Apps or sites, you would export a factory bean instead.

This example uses a String for the query.

[source,java]
----
public class GraphQlExample {

include::../../pulpogato-graphql-fpt/src/test/java/io/github/pulpogato/graphql/FindOpenPullRequestsTest.java[tags=query]

    public static void main(String[] args) {
        // create a WebClient
        WebClient graphqlWebClient = WebClient.builder()
                .baseUrl("https://api.github.com/graphql")
                .defaultHeader(HttpHeaders.AUTHORIZATION, "Bearer ...your token here...")
                .build();

include::../../pulpogato-graphql-fpt/src/test/java/io/github/pulpogato/graphql/FindOpenPullRequestsTest.java[tags=execute]

include::../../pulpogato-graphql-fpt/src/test/java/io/github/pulpogato/graphql/FindOpenPullRequestsTest.java[tags=extract]

    }
}
----

== HTTP Caching

Pulpogato provides `CachingExchangeFilterFunction` to cache HTTP responses based on standard HTTP caching headers (ETag, Last-Modified, Cache-Control).
This can significantly reduce API calls and improve performance.

=== Basic Caching Setup

[source,java,indent=0]
----
include::../../pulpogato-common/src/test/java/io/github/pulpogato/common/cache/CachingIntegrationTest.java[tags=setup-cache]
----
<1> This is a Spring Cache (ConcurrentMapCache, Caffeine, Redis, etc.)

The filter handles:

* **ETag / If-None-Match**: Stores the ETag and sends conditional requests
* **Last-Modified / If-Modified-Since**: Stores the last modified date and sends conditional requests
* **Cache-Control max-age**: Returns cached responses directly while fresh

The response includes an `X-Pulpogato-Cache` header indicating the cache status:

* `HIT` - Response served from cache without server request
* `MISS` - Response fetched from server and cached
* `REVALIDATED` - Server returned 304, cached response body returned
* `SKIP` - Response too large to cache (still returned to caller)

=== Advanced Caching Options

[source,java,indent=0]
----
include::../../pulpogato-common/src/test/java/io/github/pulpogato/common/cache/CachingIntegrationTest.java[tags=advanced-cache]
----
<1> Custom cache key mapper to customize cache keys
<2> Set maximum cacheable response size. Default is 2MB.
<3> Always send conditional requests even if cache is fresh. This is helpful when GitHub's cache directive is too long for your usecase.

Options include:

* `cacheKeyMapper` - Custom function to generate cache keys from requests
* `maxCacheableSize` - Maximum response size to cache (default: 2MB)
* `alwaysRevalidate` - Always send conditional requests even if cache is fresh